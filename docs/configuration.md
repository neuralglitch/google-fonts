# Configuration Reference

## Default Configuration

The bundle comes with sensible defaults that work out of the box:

```yaml
# config/packages/google_fonts.yaml
google_fonts:
  use_locked_fonts: false
  fonts_dir: '%kernel.project_dir%/assets/fonts'
  manifest_file: '%kernel.project_dir%/assets/fonts.json'
  defaults:
    display: 'swap'
    preconnect: true

# Production configuration (automatically applies in prod environment)
when@prod:
  google_fonts:
    use_locked_fonts: true
    defaults:
      preconnect: false  # Not needed for local fonts
```

**Key points:**

- Development uses Google Fonts CDN with preconnect
- Production automatically uses locked fonts (no separate config file needed)
- All configuration in one file using Symfony's `when@` syntax

## Configuration Options

### `use_locked_fonts`

**Type**: `boolean`  
**Default**: `false`

Whether to use locally locked fonts instead of Google Fonts CDN.

```yaml
google_fonts:
  use_locked_fonts: false  # Development
  # use_locked_fonts: true  # Production
```

**When to use:**

- `false` - Development (uses CDN, fast iteration)
- `true` - Production (uses local fonts, better performance)

### `fonts_dir`

**Type**: `string`  
**Default**: `'%kernel.project_dir%/assets/fonts'`

Directory where locked fonts are stored.

```yaml
google_fonts:
  fonts_dir: '%kernel.project_dir%/assets/fonts'
```

**Path must:**

- Be writable by PHP
- Be accessible to the web server (for production)
- Be inside `assets/` for AssetMapper integration

### `manifest_file`

**Type**: `string`  
**Default**: `'%kernel.project_dir%/assets/fonts.json'`

Path to the fonts manifest file generated by `gfonts:lock`.

```yaml
google_fonts:
  manifest_file: '%kernel.project_dir%/assets/fonts.json'
```

**Contains:**

- List of locked fonts
- Font weights and styles
- File paths
- Generated timestamp

### `defaults.display`

**Type**: `string`  
**Default**: `'swap'`

Default font-display strategy for all fonts.

```yaml
google_fonts:
  defaults:
    display: 'swap'  # swap | auto | block | fallback | optional
```

**Options:**

- `swap` (recommended) - Swap font when ready, use fallback initially
- `auto` - Browser decides strategy
- `block` - Block rendering up to 3 seconds
- `fallback` - Very short block, short swap
- `optional` - No block, no swap (best for performance)

Can be overridden per font:

```twig
{{ google_fonts('Ubuntu', '400', 'normal', 'optional') }}
```

### `defaults.preconnect`

**Type**: `boolean`  
**Default**: `true`

Whether to add preconnect hints for Google Fonts CDN in development.

```yaml
google_fonts:
  defaults:
    preconnect: true
```

**When enabled**, generates:

```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
```

**Benefits:**

- Faster font loading (DNS prefetch + TLS handshake)
- Recommended for production CDN use

**When to disable:**

- Strict CSP (Content Security Policy)
- Offline development
- Using locked fonts only

## Environment-Specific Configuration

### Using when@ Syntax (Recommended)

Symfony 5.1+ supports `when@` syntax for environment-specific config in one file:

```yaml
# config/packages/google_fonts.yaml
google_fonts:
  use_locked_fonts: false  # Development default
  fonts_dir: '%kernel.project_dir%/assets/fonts'
  manifest_file: '%kernel.project_dir%/assets/fonts.json'
  defaults:
    display: 'swap'
    preconnect: true

when@prod:
  google_fonts:
    use_locked_fonts: true   # Production uses locked fonts
    defaults:
      preconnect: false      # Not needed for local fonts

when@test:
  google_fonts:
    defaults:
      preconnect: false      # No external requests in tests
```

**Benefits:**

- Single configuration file
- Clear environment differences
- No need for separate `dev/`, `prod/`, `test/` directories

### Using Separate Files (Alternative)

If you prefer separate files per environment:

**Development:**

```yaml
# config/packages/dev/google_fonts.yaml
google_fonts:
  use_locked_fonts: false
  defaults:
    preconnect: true
```

**Production:**

```yaml
# config/packages/prod/google_fonts.yaml
google_fonts:
  use_locked_fonts: true
  defaults:
    preconnect: false
```

**Test:**

```yaml
# config/packages/test/google_fonts.yaml
google_fonts:
  use_locked_fonts: false
  defaults:
    preconnect: false
```

## Advanced Configuration

### Custom Font Directory

Store fonts outside `assets/`:

```yaml
google_fonts:
  fonts_dir: '%kernel.project_dir%/public/fonts'
  manifest_file: '%kernel.project_dir%/var/fonts.json'
```

**Note**: Ensure the directory is web-accessible.

### Multiple Environments

Use environment variables:

```yaml
google_fonts:
  use_locked_fonts: '%env(bool:USE_LOCKED_FONTS)%'
  fonts_dir: '%env(resolve:FONTS_DIR)%'
```

```dotenv
# .env.local
USE_LOCKED_FONTS=false
FONTS_DIR=%kernel.project_dir%/assets/fonts
```

### AssetMapper Integration

If using Symfony AssetMapper:

```yaml
# config/packages/asset_mapper.yaml
framework:
  asset_mapper:
    paths:
      - assets/fonts/  # Include font directory
```

Fonts in `assets/fonts/` are automatically:

- Versioned
- Served with proper cache headers
- Included in asset manifest

## Service Configuration

The bundle registers services automatically. Override if needed:

```yaml
# config/services.yaml
services:
  NeuralGlitch\GoogleFonts\Twig\GoogleFontsExtension:
    arguments:
      $environment: '%kernel.environment%'
      $useLockedFonts: '%google_fonts.use_locked_fonts%'
      $manifestFile: '%google_fonts.manifest_file%'
      $defaults: '%google_fonts.defaults%'
```

## Validation

The bundle validates configuration on container compile:

**Valid:**

```yaml
google_fonts:
  use_locked_fonts: true
  fonts_dir: '%kernel.project_dir%/assets/fonts'
```

**Invalid:**

```yaml
google_fonts:
  use_locked_fonts: "yes"  # Error: must be boolean
  fonts_dir: null           # Error: must be string
```

## Performance Considerations

### Development

```yaml
google_fonts:
  use_locked_fonts: false  # CDN is faster during development
  defaults:
    preconnect: true       # Enable for faster CDN loads
```

### Production

```yaml
google_fonts:
  use_locked_fonts: true   # Local fonts = no external requests
  defaults:
    display: 'swap'        # Best balance of performance + UX
```

### Optimization Tips

1. **Always lock fonts for production**
2. **Use `display: swap`** for best perceived performance
3. **Enable preconnect** in development with CDN
4. **Store fonts in `assets/`** for AssetMapper benefits
5. **Commit `assets/fonts.json`** to version control

## Debugging

### Check Current Configuration

```bash
php bin/console debug:config google_fonts
```

Output:

```yaml
Current configuration for "google_fonts"
=========================================

google_fonts:
    use_locked_fonts: false
    fonts_dir: /path/to/project/assets/fonts
    manifest_file: /path/to/project/assets/fonts.json
    defaults:
        display: swap
        preconnect: true
```

### Verify Services

```bash
php bin/console debug:container GoogleFonts
```

## Example Configurations

### Minimal (Defaults)

```yaml
# config/packages/google_fonts.yaml
google_fonts: ~
```

### Development

```yaml
google_fonts:
  use_locked_fonts: false
  defaults:
    display: 'swap'
    preconnect: true
```

### Production

```yaml
google_fonts:
  use_locked_fonts: true
  fonts_dir: '%kernel.project_dir%/assets/fonts'
  defaults:
    display: 'swap'
```

### Custom Paths

```yaml
google_fonts:
  fonts_dir: '%kernel.project_dir%/public/static/fonts'
  manifest_file: '%kernel.project_dir%/var/cache/fonts.json'
```

## Next Steps

- [Usage Guide](usage.md) - Using fonts in templates
- [Commands](commands.md) - CLI command reference
- [Production Setup](production.md) - Deploy with locked fonts

